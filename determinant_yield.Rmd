---
title: "Determinant Factors of 10-year Local Currency Sovereign Bonds Yield: Indonesia Case"
author: "Dea Avega Editya"
date: "8/5/2021"
output:
  pdf_document: default
  html_document: default
bibliography: baca.bib  

---
<style>
body {
text-align: justify}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(tidyverse)
library(readr)
library(readxl)
library(stringr)
library(lubridate)
library(janitor)
library(cleaner)
library(plotly)
library(tsibble)
library(openxlsx)
library(zoo)
library(purrr)
library(sugrrants)
library(GGally)
library(scales)
library(flipTime)
library(caret)
library(patchwork)

#read compiled dataset
yield_factors <- readRDS("yield_factors.rds")
```

# 1. Introduction

Indonesian government regularly issue Rupiah-denominated sovereign bonds (conventional and sharia bonds) in primary market to finance deficit of national budget. In 2021, issuance target for the sovereign bonds is around 80-85% of total deficit financing. As per 2 September 2021, total outstanding of local currency sovereign bonds is IDR4,539 Trillions or equivalent to USD318 Billions. 

The government sells the sovereign bonds through auction which conducted every Tuesday. Announcement will be released three days before the auction day. During 2-hour auction, investors (both individuals and institutions) can put their bidding in multiple prices through primary dealers and auction winners will pay their bonds based on their proposed volumes and yields. In addition to the multiple price (competitive) mechanism, the government also offer sovereign bonds to several non-competitive participants such as Indonesia Central Bank (Bank Indonesia) and Indonesia Deposit Insurance Corporation (Lembaga Penjamin Simpanan). This non-competitive buying may also be conducted by primary dealers to complement their competitive bidding purchase. Non-competitive buyers will pay their bonds based on weighted average yield (WAY) from the winning competitive bidding.

  
Since 2021, yield of 10-year sovereign bonds become one of macroeconomic assumptions in national budget, replacing Treasury Bills tenor 3-month (Surat Perbendaharaan Negara). This replacement is due to the fact that 10-year yield has larger and more significant share in nation's cost of borrowing compared to 3-month T-bills.

# 2. Literature Review

Several studies have been conducted to analyze determinant factors of sovereign bonds yield using mixed of methodologies, scopes of research and conclusion. Dachroui et al [@Dachraoui2020] study role of capital flight as a driver of sovereign bond spreads in Latin American countries, Saenong et al [@Saenong2020] analyze symmetric and asymmetric effect of crude oil prices and exchange rate on bond yields in Indonesia. 

Izadi et al [@Izadi2018] focus on local fundamental, global factors, volatility as determinant factors of yield spreads using empirical data of 24 developed countries in
North America, Europe and Pacific Rim regions in period of January, 2010 until March, 2015. Their finding include significant and positively correlation between equity market volatility (VIX) and yield speads. Their study show strong relationship between the fixed income and the stock markets particularly in developed countries.

Gadanecz et al [@Gadanecz2018] use exchange rate volatility and expected exchange rate as predictor variables of emerging market economies local currency sovereign bond yields. They conclude that exchange rate volatility is a key determinant. Moreover, they also found that foreign ownership in local currency sovereign bonds market plays important role as stabilizing force of exchange rate volatility.





Based on these literature review, this paper will review impact of 10-year US Treasury (UST) yield, 5-year Credit Default Swap (CDS), foreign ownership percentage, central bank's policy rate, exchange rate, volatility risk and auction days on 10-year sovereign bonds yield. For policy rate and exchange rate, we will use Bank Indonesia 7-day repo rate and Jakarta Interbank Spot Dollar Rate/JISDOR. For analyzing the impact of auction mechanism, we will use dummy variables of auction days and non-auction days.  

# 3. Motivation

This paper provides two new values to existing literature related to the topic. First, it will use exploratory data analysis in the beginning of analysis to gain better understanding of each predictor variable. This preliminary step is quite important because particular data characteristic, i.e. non-linearity, will need different handling method before proceeding to confirmatory step/modeling. 
Second, this is the first work which empirically study the impact of primary dealers behavior on 10-year Sovereign bonds yield in Indonesia.  

# 4. Description of Predictor Variables

## 1). External Factors  

### A. 10-year US Treasury

### B. Foreign Ownership  

## 2). Default Risk  

## 3). Financial Market Indicator (Volatility Index)  

## 4). Macroeconomic Indicator (Exchange Rate USD/IDR)  

## 5). System Risk (Primary Dealers Behavior) 

In 2021, there are 20 primary dealers of conventional bonds comprise of 16 conventional banks and 4 securities companies. For sharia bonds, there are also 20 primary dealers consist of 13 conventional banks, 3 Islamic banks and 4 securities companies. Primary dealers are required to participate in every auction and to bid for a minimum quantity of the total offering amount. They can bid both on behalf of their customers and for their own accounts. This primary dealers system is important for several reasons. First, primary dealers act as intermediary between debt managers and investors in primary market. Second, they play role as bookmakers and distributors by canvassing investor's interest and distributing bonds from auction announcement until the day of auction or commonly known as when-issued market [@Arnone2003]. In addition, primary dealers also has vital function in bridging liquidity between primary and secondary market, providing asset transformation and market making services, promoting continuous market and efficient price discovery [-@Arnone2003]. Last but not least, Arnone and Iden [-@Arnone2003] also mention that contribution of primary dealers include giving skillful advisory support related to instruments and market development.

As primary dealers can participate in competitive bidding in primary market as well as trading in secondary market, they have direct contribution on forming yield of sovereign bonds.

```{r}
### auction vs non_auc days
average_2016 <- yield_factors %>% mutate(year = year(date)) %>%  filter(year == 2016) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month) %>%  summarise(mean = mean(domestic_10y))

average_2017 <- yield_factors %>% mutate(year = year(date)) %>% filter(year == 2017) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month) %>%  summarise(mean = mean(domestic_10y))

average_2018 <- yield_factors %>% mutate(year = year(date)) %>% filter(year == 2018) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month) %>%  summarise(mean = mean(domestic_10y))

average_2019 <- yield_factors %>% mutate(year = year(date)) %>% filter(year == 2019) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month) %>%  summarise(mean = mean(domestic_10y))

average_2020 <- yield_factors %>% mutate(year = year(date)) %>% filter(year == 2020) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month) %>%  summarise(mean = mean(domestic_10y))

average_2021 <- yield_factors %>% mutate(year = year(date)) %>% filter(year == 2021) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month) %>%  summarise(mean = mean(domestic_10y))

#   
yield_factors  %>%
  mutate(month = month(date, label = TRUE), year = year(date)) %>%
  filter(year == 2018) %>% 
ggplot(aes(x = factor(day(date)), y = domestic_10y, color = factor(auction_day), alpha = 0.1))+
  geom_point(alpha = 1, size = 1.5)+scale_x_discrete(breaks = seq(1, 31, 4))+
  geom_hline(data = average_2018, aes(yintercept = mean, linetype = "Monthly Average"), colour= 'black')+
  facet_wrap(~month, ncol = 4)+xlab("Date")+ylab("10-y Yield")+
  scale_color_manual(name = "Auction Days", values= c("#BCBCBC", "#F55F5F"), labels = c("No", "Yes"))+
  scale_linetype_manual(name = "", values = "dashed")+theme(legend.position="bottom")

######comparing yield in auction day and non-auction day
# slightly higher in Feb and Dec
yield_factors  %>%
  mutate(month = month(date, label = TRUE), year = year(date)) %>% 
  select(domestic_10y, auction_day, month, year) %>% drop_na() %>% 
  filter(year > 2015 & year < 2020) %>% 
ggplot(aes(y= domestic_10y, group = auction_day, color = factor(auction_day)))+
  geom_boxplot()+
  facet_wrap(~ month)+ylab("10-year Yield")+
  scale_color_discrete(name = "Auction Days", labels = c("No", "Yes"))


yield_factors  %>%
  mutate(month = month(date, label = TRUE), year = year(date)) %>%
  filter(year > 2015) %>% 
ggplot(aes(y= domestic_10y, group = auction_day, color = factor(auction_day)))+
  geom_boxplot()+
  facet_wrap(~month)
```






a. Literature review:
- Description of Local Currency Bonds 10y, its roles and yield,
- Description of Determinant factors:
US Treasury 10y, Credit Default Swap 5y & 10y, foreign ownership, policy rate (Bank Indonesia 7-day repo rate), exchange rate (Jakarta Interbank Spot Dollar Rate/JISDOR), Issuance Mechanism in Primary Market


c. Data sources + available links
Definition and descriptive statistics of variables.
Stationarity test

d. Scope and Limitation
Cant see average bid from each group (i.e. conventional banks, foreign, insurance/pension, others)

2. Methodology

Many confounding factors, hence visualizing with plots maybe can explain  
Understanding the Relationship through EDA


In particular, the results suggest that
improved macroeconomic fundamentals, such as higher net foreign assets (in
terms of GDP or imports), lower fiscal deficits, and lower ratios of debt service to
exports and debt to GDP, help to lower sovereign spreads @arora

a. UST vs Yield
While the dramatic rise in capital flows to
emerging markets has been induced primarily by the implementation of sound
macroeconomic policies and wide structural reforms in these countries, it has
also been driven by changing conditions in industrial countries that have
encouraged investors to diversify their portfolios into developing country
assets.  Interest rate spreads (the differences between yields on
sovereign bonds of developing countries and U.S. treasury securities of
comparable maturities), which are a proxy for country risk, have tended to
move in the same direction as the changes in U.S. interest rates @arora

b. CDS vs Yield
A credit default swap (CDS) is a derivative contract that allows the investor to hedge against the default of a borrower. 
This provides a market-based measure of the credit-risk premium. 
CDS spreads indicate that the credit risk that investors
perceive is significant. @codogno

Sovereign CDS spreads are used as an indicator of foreign currency sovereign
creditworthiness.12 Lower sovereign CDS spreads are expected to lower local currency sovereign bond yields @gadanecz

c. Foreign Ownership vs Yield

d. Bank Indo Rate vs Yield

e. Exchange rate (JISDOR) vs Yield
Investors are exposed to gains and losses from exchange rate movements on their holdings of local currency sovereign bond. exchange rate risk can represent an important channel of transmission of market sentiment, uncertainty and default risk to local currency bond yield 
Exchange rate risk tends to affect liquidity
conditions in both foreign exchange and domestic bond markets, which tend to be relatively low in many EMEs even in tranquil times.
The direction of the
causality runs from exchange rate volatility to local currency sovereign bond yields. This is especially the case in Asia and eastern
Europe. In these two regions, local currency sovereign bond markets are relatively liquid and foreign participation relatively large.

The sensitivity of EME local currency sovereign bond yields to exchange rate volatility increases after
the global financial crisis, and further after the taper tantrum in mid-2013
@gadanecz


f. Volatility index (VIX) vs Yield
It is a measure of market expectations of near-term volatility conveyed by S&P500 stock index option prices and considered as a forward-looking measure of investor risk. Hartelius et al. (2008) highlights the strong dependence of emerging market returns to the VIX, which should be positively
related to changes in emerging market spreads since more risk aversion increases spreads. An attractive feature of this index is that it can
be considered as exogenous for emerging economies (Siklos, 2011). @hajer

This result could be explained by the fact that as investors become more risk-averse and seek safer assets, the expected growth in volatility encourages them to liquidate their positions in risky assets in favor of safer ones, thus increasing sovereign spreads.
@hajer

Intended to capture changes in investor sentiment which may be related to
expected changes in U.S. monetary policy. It may also pick up the effects of other market-related events, such as the flight to quality effects during the Asian crisis.
@arora

As historical data demonstrates a strong negative correlation of volatility to the stock market returns – that is, when stock returns go down, volatility rises and vice versa.(investopedia)

g. Auction day vs yield

One important feature of the Treasury security market is that, immediately following the auction announcement, market partici-pants enter into bilateral contracts for the sale and purchase of the new security before it is auctioned. In this pre-sale market, known as the when-issued market, primary dealers are the major players. As mentioned by Nyborg and Strebulaev (2004), many primary dealers are often short in the when-issued market and are also the main participants in the auction. Furthermore, in a recent empirical study on Treasury securities, Mercer et al. (2013) conclude that traders in the when-issued market "discover" the ultimate auction price. We therefore believe that primary dealers' positions created in the when-issued market have an important impact on their strategic behavior in the auctions. 
Primary dealers’ strategic behavior in the Treasury auctions can significantly increase the cost of government debt financing @tchuindjo

Greenshoe mechanism affect the decreased yield?

h. inflation vs yield
It is an indicator of macroeconomic stability and shows how a country manages its monetary policy. Higher inflation reduces the government’s ability to repay
its obligations with its domestic funds. A positive effect of the inflation rate on the sovereign yield spreads is therefore expected. @hajer

3. Key Findings

factors that steadily affect the yield? (foreign and insurance/pension fund are steadily associated with yield movement. Foreign has strongly negative correlation until 2019, while insurance/pension has strongly positive correlation)

pandemic effect? i.e. holding spending for investing in safe instrument? (need to check ownership of domestic banks, mutual funds, insurance, individual investors) 

shifting power (bonds ownership) foreign to domestic participant (Do central bank/domestic banks become more dominant)?
(Quantitative easing of Bank Indonesia and mandatory purchase of domestic banks can push down the yield)

suplementary auction (greenshoe) can reduce yield in 2020-2021?


Summary

Bibliography


#Timeline

Chapter 1 + Data collection/conversion from excel tables 31 Aug 2021,

Chapter 2 1 Sep - 25 Oct 2021,

Chapter 3 26 Oct - 12 Nov 2021,

Summary, Bibliography, cleaning Code, creating slides 13 - 19 Nov 2021




```{r }
#check volatility vs yield
yield_factors %>% mutate(year = year(date)) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_point(aes(x = vix))+
  facet_wrap(~year)

#check exchange rate vs yield
# strong and steady positive relationship between exchange rate and yield
# Rupiah weakened yield goes up
yield_factors %>% mutate(year = year(date)) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_point(aes(x = exchange_mid))+
  facet_wrap(~year)

#check debt_gdp ratio vs yield
yield_factors %>% mutate(year = year(date)) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_jitter(aes(x = debt_gdp))+
  facet_wrap(~year)

```

```{r}
# non linear relationship between yield vs inflation
yield_factors %>%
  mutate(yearmon = yearmonth(date), month = month(date), year = year(date)) %>%
  group_by(yearmon) %>% 
  summarise(avg_10y = mean(domestic_10y), avg_inflation = mean(cpi_inflation)) %>%
  ggplot(aes(y = avg_10y, x = avg_inflation)) +
  geom_point(alpha =0.5)+geom_smooth()

# yield_factors %>%
#   mutate(yearmon = yearmonth(date), month = month(date), year = year(date)) %>% 
#   group_by(yearmon) %>% 
#   ggplot(aes(y = domestic_10y, x = cpi_inflation)) +
#   geom_point(alpha =0.5)

#foreign changes
## negative relationship when foreign pct > 35%, < 35% positive relationship
### due to quantitative easing of central bank 2020-2021 and mandatory purchase of domestic banks boost domestic ownership

yield_factors %>% 
  mutate(week_year = yearweek(date), foreign_chg = foreign/tot_ownership) %>% 
  group_by(week_year) %>% 
  summarise(avg_10y = mean(domestic_10y), avg_chg = mean(foreign_chg)) %>% 
  ggplot(aes(x = avg_chg, y = avg_10y)) + 
  geom_point()

```

Several studies indicates the relationship between bonds yield and foreign ownership (i.e......). We will observe the relationship between these two variables through visualization approach. 

By just putting the number, we can not see any clear pattern from these variables. However, if we facet the plot by year, now obvious patterns of the relationship arises.

```{r foreign_yield, fig.cap = "Foreign Ownership and Domestic 10y Yield", eval=FALSE}

# yield_factors %>%  mutate(year = year(date), con_pct = con_bank/tot_ownership, bi_pct = central_bank/tot_ownership, ins_pct = ins_pension/tot_ownership) %>% 
#   # filter(year == 2019) %>% 
#   select(date, foreign, central_bank, individual, mutual_fund, con_bank, islam_bank, ins_pension, others) %>%
#   gather(key = "variable", value = "value", -date) %>% 
#   ggplot(aes(x = variable, y = value/1000, fill = value))+
#   geom_col()+
#   coord_flip()+
#   theme(legend.title = element_blank())


# yield_factors %>% 
#   mutate(year = year(date), con_pct = con_bank/tot_ownership, bi_pct = central_bank/tot_ownership, ins_pct = ins_pension/tot_ownership) %>% 
#   ggplot(aes(y = domestic_10y))+
#   geom_point(aes(x = con_pct, color = "red"))+
#   geom_point(aes(x = bi_pct))+
#   theme(legend.title = element_blank())+facet_wrap(~ year)

## others has strong positive correlation with yield
yield_factors %>% 
mutate(year = year(date), mon = month(date), con_pct = con_bank/tot_ownership, bi_pct = central_bank/tot_ownership, others_pct = others/tot_ownership) %>% 
  ggplot(aes(x = others, y = domestic_10y)) + 
  geom_point() +
  facet_wrap(~ year)

#check ownership in auction days
# yield_factors %>%
# mutate(year = year(date), month = month(date), con_pct = scale(con_bank/tot_ownership), bi_pct = central_bank/tot_ownership, others_pct = scale(others/tot_ownership), ins_pct = scale(ins_pension/tot_ownership)) %>%
#   filter(year == 2019, month == 2) %>%
#   ggplot(aes(x = date)) +
#   geom_line(aes(y = ins_pct))+
#   geom_line(aes(y = con_pct, color = "red"))+
#   geom_point(aes(y = auction_day, color = factor(auction_day)))


# bi and con_bank is balancing each other
# since 2020, they move in the same direction
# burden sharing for pandemic
yield_factors %>% 
mutate(year = year(date), con_pct = con_bank/tot_ownership, bi_pct = central_bank/tot_ownership, others_pct = scale(others/tot_ownership), ins_pct = ins_pension/tot_ownership) %>% 
  ggplot(aes(x = date)) + 
  geom_line(aes(y = bi_pct))+
  geom_line(aes(y = con_pct))

###CDS vs UST spread
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y) %>%  
#   filter(year == 2021) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = sqrt(spread_10)))+
#   geom_line(aes(y = sqrt(spread_5)), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))


### CDS vs centralbank rate spread

# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_bi = domestic_10y-rate) %>%  
#   filter(year == 2021) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = sqrt(spread_10)))+
#   geom_line(aes(y = sqrt(spread_5)), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_bi), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))


# ust vs policy rate vs spread rate-ust
# check how differ central bank rate from UST
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y, spread_bi = domestic_10y-rate, ust_bi = rate-ust_10y) %>% 
#   filter(year > 2015) %>% 
#   ggplot(aes(x = date)) + 
#   geom_area(aes(y = ust_bi), fill = "darkgreen", alpha = 0.5)+
#   geom_line(aes(y = rate))+
#   geom_line(aes(y = ust_10y), color = "red")+
#   # geom_line(aes(y = spread_ust))+
#   # geom_line(aes(y = spread_bi), color = "red", alpha = 0.5)+
#   scale_x_date(labels = date_format("%m-%Y"))
  
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y, spread_bi = domestic_10y-rate, ust_bi = rate-ust_10y) %>%  
#   filter(year > 2015) %>% 
#   ggplot(aes(x = spread_ust, y = domestic_10y))+
#   geom_jitter()

###spread ust vs yield in 2019 and 2021 is not strongly associated
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y, spread_bi = domestic_10y-rate, ust_bi = rate-ust_10y) %>%  
#   filter(year > 2015) %>% 
#   ggplot(aes(x = spread_ust, y = domestic_10y))+
#   geom_jitter()+ facet_wrap(~year)

###spread bi vs yield 
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y, spread_bi = domestic_10y-rate, ust_bi = rate-ust_10y) %>%  
#   filter(year > 2015) %>% 
#   ggplot(aes(x = spread_bi, y = domestic_10y))+
#   geom_jitter()+
#   facet_wrap(~year)

###cds vs yield 
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y, spread_bi = domestic_10y-rate, ust_bi = rate-ust_10y) %>%  
#   filter(year > 2015) %>% 
#   ggplot(aes(x = cds_5y, y = domestic_10y))+
#   geom_jitter()+
#   facet_wrap(~year)

# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = cds_10y-domestic_10y, spread_5 = cds_5y-domestic_10y, spread_ust = domestic_10y-ust_10y, spread_bi = domestic_10y-rate, ust_bi = rate-ust_10y) %>%  
#   filter(year > 2015) %>% 
#   ggplot(aes(x = cds_10y, y = domestic_10y))+
#   geom_jitter()+
#   facet_wrap(~year)


# spread movement
# spread_2016 <- yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = domestic_10y - cds_10y/100, spread_5 = domestic_10y - cds_5y/100, spread_ust = domestic_10y-ust_10y) %>% 
#   filter(year == 2016) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = spread_10))+
#   geom_line(aes(y = spread_5), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))


# spread_2017 <- yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = domestic_10y - cds_10y/100, spread_5 = domestic_10y - cds_5y/100, spread_ust = domestic_10y-ust_10y) %>% 
#   filter(year == 2017) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = spread_10))+
#   geom_line(aes(y = spread_5), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))
# 
# spread_2018 <- yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = domestic_10y - cds_10y/100, spread_5 = domestic_10y - cds_5y/100, spread_ust = domestic_10y-ust_10y) %>% 
#   filter(year == 2018) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = spread_10))+
#   geom_line(aes(y = spread_5), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))
# 
# spread_2019 <- yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = domestic_10y - cds_10y/100, spread_5 = domestic_10y - cds_5y/100, spread_ust = domestic_10y-ust_10y) %>% 
#   filter(year == 2019) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = spread_10))+
#   geom_line(aes(y = spread_5), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))
# 
# spread_2020 <- yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = domestic_10y - cds_10y/100, spread_5 = domestic_10y - cds_5y/100, spread_ust = domestic_10y-ust_10y) %>% 
#   filter(year == 2020) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = spread_10))+
#   geom_line(aes(y = spread_5), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#    scale_x_date(labels = date_format("%m-%Y"))
# 
# spread_2021 <- yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   mutate(date= date(date), month =  month(date), spread_10 = domestic_10y - cds_10y/100, spread_5 = domestic_10y - cds_5y/100, spread_ust = domestic_10y-ust_10y) %>% 
#   filter(year == 2021) %>% 
#   ggplot(aes(x = date)) + 
#   geom_line(aes(y = spread_10))+
#   geom_line(aes(y = spread_5), color = "red", alpha = 0.5)+
#   geom_line(aes(y = spread_ust), color = "blue")+
#   scale_x_date(labels = date_format("%m-%Y"))
# 
# 
# plot_spread <- patchwork::wrap_plots(spread_2016, spread_2017, spread_2018, spread_2019, spread_2020, spread_2021, ncol = 3)
###spread mostly below cds, except in 2016 and 2020 after pandemic in march

yield_factors %>% 
  mutate(date= date(date), year = year(date), bi_pct = central_bank/tot_ownership, con_pct = con_bank/tot_ownership, islam_pct = islam_bank/tot_ownership, ind_pct = individual/tot_ownership, foreign_pct = foreign/tot_ownership) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_point(aes(x = foreign_pct)) + 
  facet_wrap(~ year)

## insurance and pension fund strongly positive correlation
yield_factors %>% 
  mutate(date= date(date), year = year(date), bi_pct = central_bank/tot_ownership, con_pct = con_bank/tot_ownership, islam_pct = islam_bank/tot_ownership, ind_pct = individual/tot_ownership, ins_pct = ins_pension/tot_ownership) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_point(aes(x = ins_pct)) + 
  facet_wrap(~ year)

yield_factors %>% 
  mutate(date= date(date), year = year(date), bi_pct = central_bank/tot_ownership, con_pct = con_bank/tot_ownership, islam_pct = islam_bank/tot_ownership, ind_pct = individual/tot_ownership, ins_pct = ins_pension/tot_ownership, other_pct = others/tot_ownership) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_point(aes(x = other_pct))+
  facet_wrap(~ year)

yield_factors %>% 
  mutate(date= date(date), year = year(date), bi_pct = central_bank/tot_ownership, con_pct = con_bank/tot_ownership, islam_pct = islam_bank/tot_ownership, ind_pct = individual/tot_ownership, ins_pct = ins_pension/tot_ownership, other_pct = others/tot_ownership, mutual_pct = mutual_fund/tot_ownership) %>% 
  ggplot(aes(y = domestic_10y)) + 
  geom_point(aes(x = mutual_fund))+
  facet_wrap(~ year)

## check ggscatmat
# yield_factors %>% 
#   mutate(year = year(date)) %>% 
#   filter(year == 2020) %>% 
#     select(domestic_10y, cds_5y, ust_10y, central_bank, exchange_mid) %>%
# GGally::ggscatmat()



# 
# yield_factors %>% filter(year == 2018) %>% 
#   mutate(month = month(date)) %>% 
#   group_by(month) %>%   
# ggplot(aes(x = factor(day(date)), y = domestic_10y, color = factor(auction_day), alpha = 0.1))+
#   geom_point()+scale_x_discrete(breaks = seq(1, 31, 4))+
#   geom_hline(data = average_2018, aes(yintercept = mean), alpha = 0.5)+
#   facet_wrap(~month)
# 
# yield_factors %>% filter(year == 2019) %>% 
#   mutate(month = month(date)) %>% 
#   group_by(month) %>%   
# ggplot(aes(x = factor(day(date)), y = domestic_10y, color = factor(auction_day), alpha = 0.1))+
#   geom_point()+scale_x_discrete(breaks = seq(1, 31, 4))+
#   geom_hline(data = average_2019, aes(yintercept = mean), alpha = 0.5)+
#   facet_wrap(~month)
# 
# yield_factors %>% filter(year == 2020) %>% 
#   mutate(month = month(date)) %>% 
#   group_by(month) %>%   
# ggplot(aes(x = factor(day(date)), y = domestic_10y, color = factor(auction_day), alpha = 0.1))+
#   geom_point()+scale_x_discrete(breaks = seq(1, 31, 4))+
#   geom_hline(data = average_2020, aes(yintercept = mean), alpha = 0.5)+
#   facet_wrap(~month)
# 
# yield_factors %>% filter(year == 2021) %>% 
#   mutate(month = month(date)) %>% 
#   group_by(month) %>%   
# ggplot(aes(x = factor(day(date)), y = domestic_10y, color = auction_day, alpha = 0.1))+
#   geom_point()+scale_x_discrete(breaks = seq(1, 31, 4))+
#   geom_hline(data = average_2021, aes(yintercept = mean), alpha = 0.5)+
#   facet_wrap(~month)

# cek <- yield_factors %>% 
#   group_by(auction_day) %>% select(!pre_auction)
#   # mutate(domestic_10y = as.numeric(domestic_10y)) %>% 

# yield_factors %>% mutate(year = year(date)) %>% 
#   filter(year == 2016) %>% 
#   mutate(month = month(date)) %>% 
#   ggplot(aes(y = domestic_10y, color = auction_day)) +
#   geom_boxplot()+facet_wrap(~month)

# cek %>% filter(year == 2017) %>% 
#   mutate(month = month(date)) %>% 
#   ggplot(aes(y = domestic_10y, color = auction_day)) +
#   geom_boxplot()+facet_wrap(~month)
#   
# cek %>% filter(year == 2018) %>% 
#   mutate(month = month(date), date = date(date)) %>% 
#   ggplot(aes(y = domestic_10y, x= factor(date), color = auction_day)) +
#   geom_point()+facet_wrap(~month)
# 
# cek %>% filter(year == 2020) %>% 
#   mutate(month = month(date)) %>% 
#   ggplot(aes(y = domestic_10y, color = auction_day)) +
#   geom_boxplot()+facet_wrap(~month)+theme(legend.position = "bottom")



# yield distribution in each year
# 2018 yield move from low in early year to high in late period of year
# different direction compared to other years

# 2021 yield tend to be restrained in the middle
# yield_factors %>% mutate(year = year(date)) %>% filter(year == 2021) %>%  
#   mutate(month = month(date)) %>% 
#   ggplot(aes(x = domestic_10y, color = auction_day), group = auction_day) +
#   geom_density()+
#                facet_wrap(~ month)

###prepare variable for model
data_model <- yield_factors %>% mutate(year = year(date), month = factor(month(date))) %>% 
  mutate(foreign_pct = foreign/tot_ownership) %>% 
  mutate(date= date(date), year = factor(year), month =  factor(month(date)),
          auction_day = factor(auction_day)) %>% 
  select(date,  year, month, domestic_10y, cds_5y, ust_10y, rate, foreign_pct, vix, exchange_mid, auction_day, cpi_inflation) %>% drop_na()


# model <- lm(formula = domestic_10y ~ cds_5y + ust_10y + rate:year + foreign + ins_pension + foreign:year + ins_pension:year + auction_day:month,
#  data = data_model)


model <- lm(formula = domestic_10y ~ cds_5y + ust_10y + rate + foreign_pct + I(vix^2) + exchange_mid + auction_day,
            data = data_model)

summary(model)
tidy(model)

summary(data_model)

# highest vix in early pandemic 2020-03-16 
# MArch 2 2020 is the first case of covid
data_model %>% filter (vix == 82.69)


# best <- drop1(model, test = "F")
# summary(best)

library(broom)
aug <- broom::augment(model, data = data_model %>% filter(year != 2015) %>% drop_na())

aug %>% 
  ggplot(aes(x = .fitted, y = .resid))+
  geom_point()

aug %>%
  ggplot(aes(x = .cooksd, y = .hat))+
  geom_point()

# aug %>% 
#   ggplot(aes(x = .cooksd, y = .hat))+
#   geom_point()

outlier <- aug %>% filter(.cooksd > 0.05)

#not in
`%notin%` <- Negate(`%in%`)

data_model %>% filter(date %in% outlier$date)

####remove extreme outliers
data_model2 <- data_model %>% filter(date %notin% outlier$date)

# model <-  lm(formula = domestic_10y ~ cds_5y + ust_10y + rate + foreign:year + I(vix^2) + exchange_mid + auction_day:month, data = data_model2)


# model <- lm(formula = domestic_10y ~ cds_5y + ust_10y + rate + foreign:year + I(vix^2) + cpi_inflation + exchange_mid + auction_day:year,
#             data = data_model)

summary(model)
tidy(model)

aug <- broom::augment(model, data = data_model2 %>% filter(year != 2015) %>% drop_na())

aug %>% 
  ggplot(aes(x = .fitted, y = .resid))+
  geom_point()

aug %>% 
  ggplot(aes(x = .cooksd, y = .hat))+
  geom_point()

#check multicol
#explain GVIF variable 
car::vif(model)

# reduce to "best fit" model with

summary(model)
# model_best <- step(model, trace = FALSE)
# summary(model_best)

#diagnose model
ggnostic(model_best)

```

As we can see from the plot, in 2015 and 2016 foreign ownership seems to have no strong relationship with the yield. Different situation happened in 2017-2019 where the changes in foreign ownership seems to strong-negatively affect the bonds yield movement. 

To mention, 2017 is the year when Indonesia got investment grade rating from S&P, following FITCH and Moody's in previous years. It means that broader category of foreign investment entities (i.e. pension funds and insurance) can enter the country's market since Indonesia's rating has fulfilled their criteria of investment (yunianto, 2018). 

Particularly In 2020, the pattern is quite anomaly in which increase from 0.25-0.33% in foreign ownership seems to raise the yield from 6 up to 8.5%. The yield stumbles afterwards with the increase of foreign ownership up to 40%. 

In January-August 2021, the relationship looks non-linear with no obvious pattern. The ownership drops below 25% but interestingly yield decreases further (6-7%).

We may assume that the anomaly in 2020 and 2021 are due to Covid19 pandemic that occurred since early 2020. The government is increasing its funding to sustain the economy. The decrease in foreign portion could be because foreigners sell their bonds more than their buying (net sell), or another reason is because their portion is deluged by domestic participants (i.e. central bank), thus we will track the pattern of domestic ownership in these years to check our assumption.

```{r}

#scattermatrix
# yield_factors %>% 
#   filter(year > 2019) %>% 
# GGally::ggscatmat(columns = c(2,3,4,5))

# yield_factors %>% 
#   filter(year > 2019) %>% 
#   mutate(bi_pct = central_bank/tot_ownership, indv_pct = individual/tot_ownership, insp_pct = ins_pension/tot_ownership, mut_pct = mutual_fund/tot_ownership, sec_pct = securities_company/tot_ownership, conv_pct = con_bank/tot_ownership, isl_pct = islam_bank/tot_ownership) %>% 
#   select(domestic_10y, foreign_pct, bi_pct, indv_pct, insp_pct, mut_pct, sec_pct, conv_pct, isl_pct) %>% 
# GGally::ggscatmat()

# yield_factors %>% 
#   filter(year > 2018) %>% 
# GGally::ggscatmat(columns = c(5, 13, 14, 15, 16, 17, 18, 19))

model <- lm(domestic_10y ~ cds_5y + ust_10y + foreign + rate + con_bank, data = yield_factors)

# reduce to "best fit" model with
model_best <- step(model, trace = FALSE)
summary(model)

#diagnose model
ggnostic(model)

```

As shown in the plot, proportion of Bank Indonesia and Conventional Bank are getting bigger in 2020-2021, while proportion of foreign holders is diluted. This is can be seen as a result of implementation of new regulation on 1 May 2020 that mandate banks to reserve government bonds. This regulation has an impact on reducing bonds yield further in these two consecutive years.

Another noticeable change is proportion of individual in the bonds ownership that is growing started from mid of 2020 up to 2021. We may argue that people who prefer to hold their spending is channelling their excess money to investment, especially in a safe instrument like government bonds.

## Policy Rate
```{r eval = FALSE}

# yield_factors %>% 
#   na.omit() %>% 
#   mutate(year = year(date)) %>% 
#    filter(year != 2015) %>% 
#   select(date, domestic_10y, rate, foreign, central_bank) %>%
#   gather(key = "variable", value = "value", -date) %>% 
#   ggplot(aes(x = date, y = log(value)))+
#   geom_smooth(aes(color = variable))+theme_minimal()

## ownership pct
yield_factors %>% 
  na.omit() %>% 
  mutate(date= date(date), year = year(date), bi_pct = central_bank/tot_ownership, con_pct = con_bank/tot_ownership, islam_pct = islam_bank/tot_ownership, ind_pct = individual/tot_ownership, other_pct = others/tot_ownership, mutual_pct = mutual_fund/tot_ownership, ins_pct = ins_pension/tot_ownership, foreign_pct = foreign/tot_ownership) %>% 
   filter(year != 2015) %>% 
  select(date, foreign_pct, bi_pct, con_pct, islam_pct, ind_pct, other_pct, mutual_pct, ins_pct) %>%
  gather(key = "variable", value = "value", -date) %>% 
  ggplot(aes(x = date, y = value))+
  geom_area(aes(fill = variable), alpha = 0.7)+
  theme_classic()

####Others = securities, corporations, and foundations.

# spread pol-rate vs yield
# 2020 spread range between policy rate and yield is quite dispersed
# 2021 spread range is the narrowest
# 
yield_factors %>% 
  na.omit() %>% 
  mutate(year = year(date), spread = abs(domestic_10y-rate)) %>%
  filter(year > 2015) %>% 
  select(date, year, spread, domestic_10y, rate) %>% 
  ggplot(aes(y = spread))+
  geom_boxplot()+
  facet_wrap(~year)


```

From plot above, the movement of domestic 10y yield is parallel with movement of policy rate. The median spread in 2016 until 2018 is quite the same (around 2.5) while median spread of 2019 is the lowest. In 2020 and 2021, the differences between 10y yield and policy rate are increase with median spread is about 3. The range of spread in 2020 is also the widest compared to other observed years.

#Bibliography

